<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        /*全局變數*/
        :root {
            /*音量拉條上的點*/
            --VolThumb_Appearance: none;
            --VolThumb_BackgroundColor: aqua;
            --VolThumb_Height: 40px;
            --VolThumb_Width: 25px;
            --VolThumb_BorderRadius: 5px;
            --VolThumb_Border: 3px solid black;
        }

        #Main {
            border: 5px solid black;
            border-radius: 10px;
            padding: 20px;
            width: 800px;
            margin: auto;
        }

        .Muted {
            background-color: pink;
        }

        #Btns span {
            border: 1px solid black;
            cursor: pointer;
            font-size: 1.5rem;
            box-shadow: 3px 3px 7px black;
            padding: 3px;
            font-family: webdings;
        }

        /*音量拉條*/
        #VolumeControl>input[type="range"] {
            appearance: none;
            border: 1px solid black;
            border-radius: 10px;
            /*background-color: bisque;*/
            background-image: linear-gradient(to right, #f06, #4a90e2);
            width: 80%;
            height: 30px;
            margin: auto;
        }

        /*音量拉條上的點*/
        #VolumeControl>input[type="range"]::-webkit-slider-thumb {
            appearance: var(--VolThumb_Appearance);
            background-color: var(--VolThumb_BackgroundColor);
            height: var(--VolThumb_Height);
            width: var(--VolThumb_Width);
            border-radius: var(--VolThumb_BorderRadius);
            border: var(--VolThumb_Border);
        }

        /*音量拉條上的點 (對火狐用)*/
        #VolumeControl>input[type="range"]::-moz-range-thumb {
            appearance: var(--VolThumb_Appearance);
            background-color: var(--VolThumb_BackgroundColor);
            height: var(--VolThumb_Height);
            width: var(--VolThumb_Width);
            border-radius: var(--VolThumb_BorderRadius);
            border: var(--VolThumb_Border);
        }

        #PlayingInfo>text {
            text-align: center;
        }

        #MusicList {
            width: 100%;
            font-size: 16pt;
            text-align: center;
            background-color: rgb(217, 233, 228);
            font-weight: 900;
        }
    </style>
</head>

<body>

    <audio src="../music/moon.mp3" title="Moon" controls id="MusicPlayer"></audio>
    <hr>

    <div id="Main">
        <!--音樂選單-->
        <select id="MusicList" onchange="ChangeMusic(0)" width="100%">
            <option value="../music/moon.mp3" title="Moon">Moon</option>
            <option value="../music/elysees.mp3" title="Elysees">Elysees</option>
            <option value="../music/airball.mp3" title="Airball">Airball</option>
            <option value="../music/nothing.mp3" title="Nothing">Nothing</option>
            <option value="../music/rain.mp3" title="Rain">Rain</option>
            <option value="../music/travel.mp3" title="Travel">Travel</option>
        </select>
        <!--音樂選單-->
        <hr>
        <!--播放控制按鈕-->
        <div id="Btns">
            <span onclick="PlayPauseMusic()">4</span><!--播放/暫停-->

            <!--<span onclick="playMusic()">4</span>--><!--播放-->
            <!--<span onclick="pauseMusic()">;</span>--><!--暫停-->

            <span onclick="stopMusic()">&lt;</span>
            <span onclick="ChangeMusic(-1)">9</span><!--上一首-->
            <span onclick="MusicSeek(-5)">7</span><!--快退-->
            <span onclick="MusicSeek(5)">8</span><!--快進-->
            <span onclick="ChangeMusic(1)">⏭</span><!--下一首-->

            <span onclick="SetMute()">U</span><!--靜音-->
            <span onclick="SetLoop()">循環</span><!--循環-->
        </div>
        <!--播放控制按鈕-->
        <hr>
        <!--音量控制-->
        <div id="VolumeControl">
            <!--音量拉條-->
            <input type="range" id="Volume" min="0" max="100" value="100" oninput="VolumeChange(this.value)">
            <input type="text" id="VolumeText" readonly value="100" style=" width: 30px; 
                            background-color: black; 
                            color: yellow;
                            text-align: center;">
        </div>
        <!--音量控制-->
        <hr>
        <!--進度條-->
        <input type="range" id="ProgressBar" min="0" max="100" value="0">
        <!--進度條-->
        <hr>
        <!--播放資訊顯示-->
        <div id="PlayingInfo">
            <div id="MusicTime">--:--/--:--</div>
        </div>
        <!--播放資訊顯示-->
    </div>

    <script>
        //使用者觸發click事件,則播放音樂
        let MusicPlayer = document.getElementById("MusicPlayer");


        var ProgressBar = document.getElementById("ProgressBar");
        // ProgressBar.onclick=(()=>{
        //     console.log("ProgressBar Clicked");
        // });
        // ProgressBar.oninput = (event) => {
        //     //一變動就觸發
        //     console.log("ProgressBar oninput");
        // };
        ProgressBar.onpointerdown = (event) => {
            console.log("ProgressBar onpointerdown");
            ProgressBarOnDrag = true; //設置為正在拖動進度條
        };
        ProgressBar.onpointerup = (event) => {
            console.log("ProgressBar onpointerup");
            ProgressBarOnDrag = false; //設置為不再拖動進度條

            MusicPlayer.currentTime = ProgressBar.value; //設置音樂的當前播放時間為進度條的值
        };

        var ProgressBarOnDrag = false; //是否正在拖動進度條

        MusicPlayer.onended = () => {
            console.log("音樂結束了");

        };

        //播放音樂
        // function playMusic() {
        //     MusicPlayer.play();
        // }

        // function pauseMusic() {
        //     MusicPlayer.pause();
        // }

        let PlayPauseButton = document.getElementById("Btns").children[0];
        function PlayPauseMusic() {
            if (MusicPlayer.paused) {
                console.log("播放");

                //開始撥放
                //console.log("A1 "+MusicList.innerHTML);
                MusicPlayer.play();
                //console.log("A2 "+MusicList.innerHTML);
                PlayPauseButton.innerHTML = ";"; //更改按鈕顯示為暫停

                setInterval(SetMusicTime, 500);

                ProgressBar.max = MusicPlayer.duration; //設置進度條的最大值為音樂的總時長

                console.log(MusicPlayer.title);
            } else {
                console.log("暫停");

                //暫停
                MusicPlayer.pause();
                PlayPauseButton.innerHTML = "4"; //更改按鈕顯示為播放
            }
        }

        function stopMusic() {
            //console.log("StopMusic");

            MusicPlayer.pause();
            MusicPlayer.currentTime = 0; //將音樂播放時間歸零
            PlayPauseButton.innerHTML = "4"; //更改按鈕顯示為播放
        }

        function LastMusic() {
            MusicPlayer.LastMusic();
        }
        function MusicSeek(Time) {
            MusicPlayer.currentTime += Time;
        }
        function NextMusic() {
            MusicPlayer.NextMusic();
        }

        //靜音
        function SetMute() {
            //MusicPlayer.muted = !MusicPlayer.muted; //切換靜音狀態

            //event.target.innerHTML = MusicPlayer.muted ? "V" : "U"; //更改按鈕顯示
            if (MusicPlayer.muted) {
                MusicPlayer.muted = false;
                event.target.innerHTML = "U"; //移除靜音樣式
                event.target.className = "";
            } else {
                MusicPlayer.muted = true;
                event.target.innerHTML = "V"; //添加靜音樣式
                event.target.className = "Muted";
            }
        }
        //循環
        function SetLoop() {
            MusicPlayer.SetLoop();
        }

        //--------------------------------------------------音量
        var VolumeControl = document.getElementById("VolumeControl");
        function VolumeChange(Volume) {
            MusicPlayer.volume = Volume / 100;

            //console.log(Volume);
            //document.getElementById("VolumeText").value = Volume;
            VolumeControl.children[1].value = Volume; //更新音量值的文字顯示

            //動態調整音量拉條的背景色
            VolumeControl.children[0].style.backgroundImage = `linear-gradient(to right, #f06 ${Volume}%, #4a90e2 ${Volume}%)`;
            //background-image: linear-gradient(to right, #f06 , #4a90e2);
        }
        VolumeChange(100);
        //---------------------------------------------------音量
        var PlayingInfo = document.getElementById("PlayingInfo");

        var MusicTime = PlayingInfo.children[0];
        function SetMusicTime() {
            //MusicTime.innerHTML="ASDASD";

            MusicTime.innerHTML = GetTimeFormat(MusicPlayer.currentTime) + "/" + GetTimeFormat(MusicPlayer.duration);
            //console.log(1);

            if (!ProgressBarOnDrag) {
                //console.log("SetProgressBar " + MusicPlayer.currentTime);
                ProgressBar.value = MusicPlayer.currentTime; //更新進度條的值

                //進度條填色
                var W = MusicPlayer.duration / MusicPlayer.currentTime * 100;
                ProgressBar.style.backgroundImage = `linear-gradient(to right, #f06 ${W}%, #4a90e2 ${W}%)`;
            }
        }

        function GetTimeFormat(t) {
            //總秒數轉換為00:00格式文字

            var Min = parseInt(t.toFixed(0) / 60);
            var Sec = parseInt(t.toFixed(0) % 60);

            return Min.toString().padStart(2, '0') + ":" + Sec.toString().padStart(2, '0');
        }

        function ChangeMusic(n) {
            var Index = MusicList.selectedIndex;

            if ((n == -1 && Index > 0) || n == 1 && Index < MusicList.length - 1) {
                MusicPlayer.src = MusicList.children[Index + n].value; //更改音樂來源
                MusicPlayer.title = MusicList.children[Index + n].innerText;

                MusicList.children[Index + n].selected = true;
                //console.log(event.target.children[a].innerText);
            }
            else {
                console.log("MusicList到底");
            }
        }

    </script>


</body>

</html>